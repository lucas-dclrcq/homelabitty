apiVersion: kyverno.io/v1
kind: ClusterPolicy
metadata:
  name: add-reflector-annotations-to-pgo-users-secrets
spec:
  rules:
    - name: add-reflector-annotations-to-pgo-users-secrets
      match:
        any:
          - resources:
              names:
                - "postgres-pguser-*"
              kinds:
                - Secret
              namespaces:
                - infrastructure
      mutate:
        patchesJson6902: |-
          - path: /metadata/annotations/reflector.v1.k8s.emberstack.com~1reflection-allowed
            op: add
            value: "true"
          - path: /metadata/annotations/reflector.v1.k8s.emberstack.com~1reflection-allowed-namespaces
            op: add
            value: "media,default,auth"
          - path: /metadata/annotations/reflector.v1.k8s.emberstack.com~1reflection-auto-enabled
            op: add
            value: "true"
          - path: /metadata/annotations/reflector.v1.k8s.emberstack.com~1reflection-auto-namespaces
            op: add
            value: "media,default,auth"
